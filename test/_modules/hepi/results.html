<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>hepi.results &mdash; HEPi  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> HEPi
          </a>
              <div class="version">
                0.1.13-41-ga2c7374
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Versions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://apn-pucky.github.io/HEPi/">Stable</a></li>
<li class="toctree-l1"><a class="reference external" href="https://apn-pucky.github.io/HEPi/test/">Dev</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/APN-Pucky/HEPi">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/demo_resummino.html">Resummino example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/test_distribute.html">Distribute resummino run files to clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/test_interpolate.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/test_madgraph.html">MadGraph example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/test_pyslha.html">pyslha comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/test_spheno.html">SPheno example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/test_write.html">Result writing example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/hepi/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hepi</span></code></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HEPi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
          <li><a href="../hepi.html">hepi</a> &raquo;</li>
      <li>hepi.results</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for hepi.results</h1><div class="highlight"><pre>
<span></span>&quot;&quot;&quot;Results and postprocessing for the :mod:`hepi` package.&quot;&quot;&quot;
from .util import DictData
import numpy as np
from uncertainties import unumpy
from smpl import plot
import lhapdf
import warnings

<div class="viewcode-block" id="required_numerical_uncertainty_factor"><a class="viewcode-back" href="../../autoapi/hepi/results/index.html#hepi.required_numerical_uncertainty_factor">[docs]</a>required_numerical_uncertainty_factor = 10</div>
&quot;&quot;&quot;If the numerical uncertainty is :attr:`required_numerical_uncertainty_factor` times higher than the scale or pdf uncertainty a warning is shown.&quot;&quot;&quot;


<div class="viewcode-block" id="Result"><a class="viewcode-back" href="../../autoapi/hepi/results/index.html#hepi.Result">[docs]</a>class Result(DictData):
    &quot;&quot;&quot;
    General result class.

    Attributes:
        LO (:obj:`double`): Leading Order result. Defaults to None.
        NLO (:obj:`double`): Next-to-Leading Order result. Defaults to None.
        NLO_PLUS_NLL (:obj:`double`): Next-to-Leading Order plus Next-to-Leading Logarithm result. Defaults to None.
        K_LO (:obj:`double`): LO divided by LO.
        K_NLO (:obj:`double`): NLO divided by LO result.
        K_NLO_PLUS_NLL (:obj:`double`): NLO+NLL divided by LO.
        K_aNNLO_PLUS_NNLL (:obj:`double`): aNNLO+NNLL divided by LO.
        NLO_PLUS_NLL_OVER_NLO (:obj:`double`): NLO+NLL divided by NLO.
        aNNLO_PLUS_NNLL_OVER_NLO (:obj:`double`): aNNLO+NNLL divided by NLO.
    &quot;&quot;&quot;

    def __init__(self,
                 lo=None,
                 nlo=None,
                 nlo_plus_nll=None,
                 annlo_plus_nnll=None):
        &quot;&quot;&quot;
        Sets given and computes dependent ``Attributes``.

        Args:
            lo (:obj:`double`): corresponds to :attr:`LO`.
            nlo (:obj:`double`): corresponds to :attr:`NLO`.
            nlo_plus_nll (:obj:`double`): corresponds to :attr:`NLO_PLUS_NLL`.
            annlo_plus_nnll (:obj:`double`): corresponds to :attr:`aNNLO_PLUS_NNLL`.
        &quot;&quot;&quot;
        self.LO = lo
        self.NLO = nlo
        self.NLO_PLUS_NLL = nlo_plus_nll
        self.aNNLO_PLUS_NNLL = annlo_plus_nnll
        if lo is not None and lo != 0:
            self.K_LO = lo / lo
        else:
            self.K_LO = None
        if nlo is not None and lo != 0:
            self.K_NLO = nlo / lo
        else:
            self.K_NLO = None
        if nlo_plus_nll is not None and lo != 0:
            self.K_NLO_PLUS_NLL = nlo_plus_nll / lo
        else:
            self.K_NLO_PLUS_NLL = None

        if nlo_plus_nll is not None and nlo != 0:
            self.NLO_PLUS_NLL_OVER_NLO = nlo_plus_nll / nlo
        else:
            self.NLO_PLUS_NLL_OVER_NLO = None

        if annlo_plus_nnll is not None and lo != 0:
            self.K_aNNLO_PLUS_NNLL = annlo_plus_nnll / lo
        else:
            self.K_aNNLO_PLUS_NNLL = None

        if annlo_plus_nnll is not None and nlo != 0:
            self.aNNLO_PLUS_NNLL_OVER_NLO = annlo_plus_nnll / nlo
        else:
            self.aNNLO_PLUS_NNLL_OVER_NLO = None</div>


# TODO detect which errors also for scales
<div class="viewcode-block" id="pdf_errors"><a class="viewcode-back" href="../../autoapi/hepi/results/index.html#hepi.pdf_errors">[docs]</a>def pdf_errors(li,
               dl,
               ordernames=[&quot;LO&quot;, &quot;NLO&quot;, &quot;aNNLO_PLUS_NNLL&quot;],
               confidence_level=90):
    &quot;&quot;&quot;
    Just like `pdf_error` but over a list of ordernames.
    &quot;&quot;&quot;
    r_dl = dl
    for o in ordernames:
        r_dl = pdf_error(li, r_dl, o, confidence_level=confidence_level)

    return r_dl</div>


<div class="viewcode-block" id="pdf_error"><a class="viewcode-back" href="../../autoapi/hepi/results/index.html#hepi.pdf_error">[docs]</a>def pdf_error(li, dl, ordername=&quot;LO&quot;, confidence_level=90):
    &quot;&quot;&quot;
    Computes Parton Density Function (PDF) uncertainties through :func:`lhapdf.set.uncertainty`.

    Args:
        li (:obj:`list` of :class:`Input`): Input list.
        dl (:obj:`dict`): :class:`Result` dictionary with lists per entry.
        ordername (`str`): Name of the order.
        confidence_level (:obj:`double`): Confidence Level for PDF uncertainty

    Returns:
        :obj:`dict`: Modified `dl` with new `LO`/`NLO`/`NLO_PLUS_NLL` _ `PDF`/`PDF_CENTRAL`/`PDF_ERRPLUS`/`PDF_ERRMINUS`/`PDF_ERRSYM` entries.
            - `LO`/`NLO`/`NLO_PLUS_NLL` _ `PDF` contains a symmetrized :mod:`uncertainties` object.
    &quot;&quot;&quot;
    global required_numerical_uncertainty_factor
    example = li[0]
    members = [
        attr for attr in dir(example)
        if not callable(getattr(example, attr)) and not attr.startswith(&quot;__&quot;)
    ]

    dl[ordername + &quot;_PDF&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_PDF_CENTRAL&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_PDF_ERRPLUS&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_PDF_ERRMINUS&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_PDF_ERRSYM&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))

    for i in range(len(dl[&quot;pdfset_nlo&quot;])):
        if dl[&quot;pdfset_nlo&quot;][i] == 0 and dl[&quot;mu_f&quot;][i] == 1.0 and dl[&quot;mu_r&quot;][
                i] == 1.0:
            pdfset = lhapdf.getPDFSet(dl[&quot;pdf_nlo&quot;][i])
            pdfs = [0.0] * pdfset.size
            for j in range(len(dl[&quot;pdfset_nlo&quot;])):
                same = True
                for s in members:
                    if not (
                            dl[s][i] == dl[s][j]
                    ) and s != &quot;pdfset_nlo&quot; and s != &quot;precision&quot; and s != &quot;max_iters&quot;:
                        same = False
                if same:
                    pdfs[dl[&quot;pdfset_nlo&quot;][j]] = j

        # lo_unc = pdfset.uncertainty(
        #    [plot.unv(dl[&quot;LO&quot;][k]) for k in pdfs], -1)
        #if ordername == &quot;LO&quot;:
        #    dl.loc[i, &quot;LO_PDF_CENTRAL&quot;] = plot.unv(dl[&quot;LO&quot;][i])
        #    dl.loc[i, &quot;LO_PDF_ERRPLUS&quot;] = 0.0
        #    dl.loc[i, &quot;LO_PDF_ERRMINUS&quot;] = 0.0
        #    dl.loc[i, &quot;LO_PDF_ERRSYM&quot;] = 0.0
        #else:
            nlo_unc = pdfset.uncertainty(
                [plot.unv(dl[ordername][k]) for k in pdfs], confidence_level)
            dl.loc[i, ordername + &quot;_PDF_CENTRAL&quot;] = nlo_unc.central
            dl.loc[i, ordername + &quot;_PDF_ERRPLUS&quot;] = nlo_unc.errplus
            dl.loc[i, ordername + &quot;_PDF_ERRMINUS&quot;] = -nlo_unc.errminus
            dl.loc[i, ordername + &quot;_PDF_ERRSYM&quot;] = nlo_unc.errsymm
            #TODO error sym to minus and plus
            #if ordername != &quot;LO&quot;:
            if (plot.usd(dl[ordername][i]) *
                    required_numerical_uncertainty_factor &gt;
                    dl[ordername + &quot;_PDF_ERRPLUS&quot;][i]
                    or plot.usd(dl[ordername][i]) *
                    required_numerical_uncertainty_factor &gt;
                    -dl[ordername + &quot;_PDF_ERRMINUS&quot;][i]):
                rel = plot.unv(dl[ordername][i])
                warnings.warn(
                    &quot;too bad numerical precision vs pdf @ &quot; + ordername +
                    &quot; num: &quot; + str(plot.usd(dl[ordername][i]) / rel * 100.) +
                    &quot;% vs &quot; +
                    str(dl[ordername + &quot;_PDF_ERRPLUS&quot;][i] / rel * 100.) +
                    &quot;% to pdf: &quot; +
                    str(dl[ordername + &quot;_PDF_ERRMINUS&quot;][i] / rel * 100.) + &quot;%&quot;,
                    RuntimeWarning)

    mask = dl[ordername + &quot;_PDF_CENTRAL&quot;].notnull()
    dl.loc[mask, ordername + &quot;_PDF&quot;] = unumpy.uarray(
        plot.unv(dl[ordername + &quot;_PDF_CENTRAL&quot;][mask]) +
        dl[ordername + &quot;_PDF_ERRPLUS&quot;][mask] / 2. +
        dl[ordername + &quot;_PDF_ERRMINUS&quot;][mask] / 2.,
        (+dl[ordername + &quot;_PDF_ERRPLUS&quot;][mask] -
         dl[ordername + &quot;_PDF_ERRMINUS&quot;][mask]) / 2.)

    return dl</div>


<div class="viewcode-block" id="scale_errors"><a class="viewcode-back" href="../../autoapi/hepi/results/index.html#hepi.scale_errors">[docs]</a>def scale_errors(li, dl, ordernames=[&quot;LO&quot;, &quot;NLO&quot;, &quot;aNNLO_PLUS_NNLL&quot;]):
    &quot;&quot;&quot;
    Just like `scale_error` but over a list of ordernames.
    &quot;&quot;&quot;
    r_dl = dl
    for o in ordernames:
        r_dl = scale_error(li, r_dl, o)

    return r_dl</div>


<div class="viewcode-block" id="scale_error"><a class="viewcode-back" href="../../autoapi/hepi/results/index.html#hepi.scale_error">[docs]</a>def scale_error(li, dl, ordername=&quot;LO&quot;):
    &quot;&quot;&quot;
    Computes seven-point scale uncertainties from the results where the renormalization and factorization scales are varied by factors of 2 and  relative factors of four are excluded (cf. :meth:`seven_point_scan`).

    Args:
        li (:obj:`list` of :class:`Input`): Input list.
        dl (:obj:`dict`): :class:`Result` dictionary with lists per entry.

    Returns:
        :obj:`dict`: Modified `dl` with new `LO`/`NLO`/`NLO_PLUS_NLL` _ `SCALE`/`SCALE_ERRPLUS`/`SCALE_ERRMINUS`/`SCALE_ERRSYM` entries.
            - `LO`/`NLO`/`NLO_PLUS_NLL` _ `SCALE` contains a symmetrized :mod:`uncertainties` object.
    &quot;&quot;&quot;
    global required_numerical_uncertainty_factor
    example = li[0]
    members = [
        attr for attr in dir(example)
        if not callable(getattr(example, attr)) and not attr.startswith(&quot;__&quot;)
    ]
    dl[ordername + &quot;_SCALE&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_SCALE_ERRPLUS&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_SCALE_ERRMINUS&quot;] = np.array([None] *
                                                 len(dl[&quot;pdfset_nlo&quot;]))

    for i in range(len(dl[&quot;pdfset_nlo&quot;])):
        if dl[&quot;pdfset_nlo&quot;][i] == 0 and dl[&quot;mu_f&quot;][i] == 1.0 and dl[&quot;mu_r&quot;][
                i] == 1.0:
            scales = []
            for j in range(len(dl[&quot;pdfset_nlo&quot;])):
                same = True
                for s in members:
                    if not (
                            dl[s][i] == dl[s][j]
                    ) and s != &quot;mu_f&quot; and s != &quot;mu_r&quot; and s != &quot;precision&quot; and s != &quot;max_iters&quot;:
                        same = False
                if same:
                    scales.append(j)

            # lo_unc = pdfset.uncertainty(
            #    [plot.unv(dl[&quot;LO&quot;][k]) for k in pdfs], -1)
            dl.loc[i, ordername + &quot;_SCALE_ERRPLUS&quot;] = np.max(
                [plot.unv(dl[ordername][k])
                 for k in scales]) - plot.unv(dl[ordername][i])
            dl.loc[i, ordername + &quot;_SCALE_ERRMINUS&quot;] = np.min(
                [plot.unv(dl[ordername][k])
                 for k in scales]) - plot.unv(dl[ordername][i])
            if (plot.usd(dl[ordername][i]) *
                    required_numerical_uncertainty_factor &gt;
                    dl[ordername + &quot;_SCALE_ERRPLUS&quot;][i]
                    or plot.usd(dl[ordername][i]) *
                    required_numerical_uncertainty_factor &gt;
                    -dl[ordername + &quot;_SCALE_ERRMINUS&quot;][i]):
                rel = plot.unv(dl[ordername][i])
                warnings.warn(
                    &quot;too bad numerical precision vs scale @ num:&quot; + ordername +
                    &quot; &quot; + str(plot.usd(dl[ordername][i]) / rel * 100.) +
                    &quot;% vs scale:&quot; +
                    str(dl[ordername + &quot;_SCALE_ERRPLUS&quot;][i] / rel * 100.) +
                    &quot;% to &quot; +
                    str(dl[ordername + &quot;_SCALE_ERRMINUS&quot;][i] / rel * 100.) +
                    &quot;%&quot;, RuntimeWarning)

    mask = dl[ordername + &quot;_SCALE_ERRPLUS&quot;].notnull()
    dl.loc[mask, ordername + &quot;_SCALE&quot;] = unumpy.uarray(
        plot.unv(dl[ordername][mask]) +
        dl[ordername + &quot;_SCALE_ERRPLUS&quot;][mask] / 2. +
        dl[ordername + &quot;_SCALE_ERRMINUS&quot;][mask] / 2.,
        (+dl[ordername + &quot;_SCALE_ERRPLUS&quot;][mask] -
         dl[ordername + &quot;_SCALE_ERRMINUS&quot;][mask]) / 2.)

    return dl</div>


<div class="viewcode-block" id="combine_errors"><a class="viewcode-back" href="../../autoapi/hepi/results/index.html#hepi.combine_errors">[docs]</a>def combine_errors(dl, ordernames=[&quot;LO&quot;, &quot;NLO&quot;, &quot;aNNLO_PLUS_NNLL&quot;]):
    &quot;&quot;&quot;
    Just like `combine_error` but over a list of ordernames.
    &quot;&quot;&quot;
    r_dl = dl
    for o in ordernames:
        r_dl = combine_error(r_dl, o)

    return r_dl</div>


<div class="viewcode-block" id="combine_error"><a class="viewcode-back" href="../../autoapi/hepi/results/index.html#hepi.combine_error">[docs]</a>def combine_error(dl: dict, ordername=&quot;LO&quot;):
    &quot;&quot;&quot;
    Combines seven-point scale uncertainties and pdf uncertainties from the results by Pythagorean addition.

    Note:
        Running :func:`scale_errors` and :func:`pdf_errors` before is necessary.

    Args:
        dl (:obj:`dict`): :class:`Result` dictionary with lists per entry.

    Returns:
        :obj:`dict`: Modified `dl` with new `LO`/`NLO`/`NLO_PLUS_NLL` _ `COMBINED`/`ERRPLUS`/`ERRMINUS` entries.
            - `LO`/`NLO`/`NLO_PLUS_NLL` _ `COMBINED` contains a symmetrized :mod:`uncertainties` object.
    &quot;&quot;&quot;
    dl[ordername + &quot;_NOERR&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_ERRPLUS&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_ERRMINUS&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))
    dl[ordername + &quot;_COMBINED&quot;] = np.array([None] * len(dl[&quot;pdfset_nlo&quot;]))

    mask = dl[ordername + &quot;_PDF_CENTRAL&quot;].notnull()
    dl.loc[mask, ordername + &quot;_NOERR&quot;] = plot.unv(dl[ordername +
                                                     &quot;&quot;][mask]).astype(float)
    dl.loc[mask, ordername + &quot;_ERRPLUS&quot;] = np.sqrt(
        dl[ordername + &quot;_PDF_ERRPLUS&quot;][mask].astype(float)**2 +
        dl[ordername + &quot;_SCALE_ERRPLUS&quot;][mask].astype(float)**2)
    dl.loc[mask, ordername + &quot;_ERRMINUS&quot;] = -np.sqrt(
        dl[ordername + &quot;_PDF_ERRMINUS&quot;][mask].astype(float)**2 +
        dl[ordername + &quot;_SCALE_ERRMINUS&quot;][mask].astype(float)**2)
    dl.loc[mask, ordername + &quot;_COMBINED&quot;] = unumpy.uarray(
        plot.unv(dl[ordername + &quot;&quot;][mask]) +
        dl[ordername + &quot;_ERRPLUS&quot;][mask] / 2. +
        dl[ordername + &quot;_ERRMINUS&quot;][mask] / 2.,
        +dl[ordername + &quot;_ERRPLUS&quot;][mask] - dl[ordername + &quot;_ERRMINUS&quot;][mask])

    return dl</div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, APN-Pucky.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>